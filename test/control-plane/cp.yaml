# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
apiVersion: v1
kind: Namespace
metadata:
  name: dubbo-system
  labels:
    dubbo.io/system-namespace: "true"

---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: dubbo-admission-mutating-webhook-configuration
  namespace: dubbo-system
  labels:
    app: dubbo-control-plane
    app.kubernetes.io/name: dubbo
    app.kubernetes.io/instance: dubbo
webhooks:
  - name: mesh.defaulter.dubbo-admission.dubbo.io
    admissionReviewVersions: ["v1"]
    failurePolicy: Fail
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values: ["kube-system"]
    clientConfig:
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFVENDQWZtZ0F3SUJBZ0lVSU1hSTdZRStGajF3V0FxQ04zUk5hK0hiUGxrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01NVEF1TWpNdU1UTXlMalV4TUNBWERUSTBNRE15TlRBek16a3lOMW9ZRHpJdwpOVEV3T0RFeE1ETXpPVEkzV2pBWE1SVXdFd1lEVlFRRERBd3hNQzR5TXk0eE16SXVOVEV3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM4Nlc3L3RQLzN4Qk5LMmpZaEVzejBuQ1FjZFExTXQwNEUKcmo2MTlQQmMzbUx4R0tIcjhRdVBwTmw3NDBJdktNSFRyYi9FcWRRRDNQTUN3R2MzZHNzUEYrOHRKNXFtTlFrTwphOVJsU0pZVTdEQVczeFJIdzNkMFk1SkcxQUZxeDZnTlpmU3NCWmdhT2JROFhYQXNxUmpyWXJSWlY1QldKV0c3CkRQd2N1dWR5SExpU2F6dWFuaERkNE5FY2tzL2hlejFqSFdTZWtyaW1oeVNvWjNHMC9OUmlxdnZuOWN1bUtnNEcKSkZlOWQwSGFPbm9Td29mTU9wNFA0eFB4OFk5Qld5S1pFSUVFREt5VmwvWnpNODlpWjkxMy8wS3lhWEFKY251TQpIeitCT2VjK29pYzJJeTZPeUJHcFlJVE5LMHBGMURxV3RPVDltcFQxb2JtSDlDWXJySUpwQWdNQkFBR2pVekJSCk1CMEdBMVVkRGdRV0JCUWZSVEd5UEc3bFg2VDlxUXgvaS9xVVJsOEpoREFmQmdOVkhTTUVHREFXZ0JRZlJUR3kKUEc3bFg2VDlxUXgvaS9xVVJsOEpoREFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQQpBNElCQVFBTVV1T1l2b3VmOW9vZFNFOUF1a3I0bDg4WTNKUUlUMlZpQlhIc0JEcjFnWlBkaks5Nlc1RjJsUFl0CmlBb3dCdlRiVHJyamI1WVFTZmxvc3kxYW1oSzB5QWFNaUYyd1d1dDkrTzdTY1Rza0dIeGNDbklhTjgzSmJkM20KWjczR3doNlcyb2VQYk12eFZNNjJ3Ykl3SE00U3FqRDRqK203OHFHM2JZVi9CK29Db2xwU2JuQzkrVEpnUmFSSQpTV1pqUnZzUERlMFhyam5JMFIwbXBNdTlBNjVWVDVzdEQ0SHlMZFFucExVWW9zYXJUdVhzN2VxWUhmUnpmanB4CjNQSlJGaEh6bytCVVZzVGdMRGhQbnJaNzdOTEtUSTJBTjNmU2JubGlkNFM3alNRNmk1TGI0TXFHWUY5anlPdHoKbmZIb0RxWUdyaVFJY0N5WW9kZlkwVGRzWS9LegotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      url: https://10.23.132.51:5443/default-dubbo-io-v1alpha1-mesh
    rules:
      - apiGroups:
          - dubbo.io
        apiVersions:
          - v1alpha1
        operations:
          - CREATE
          - UPDATE
        resources:
          - meshes
    sideEffects: None
  - name: owner-reference.dubbo-admission.dubbo.io
    admissionReviewVersions: ["v1"]
    failurePolicy: Fail
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values: ["dubbo-system"]
    clientConfig:
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFVENDQWZtZ0F3SUJBZ0lVSU1hSTdZRStGajF3V0FxQ04zUk5hK0hiUGxrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01NVEF1TWpNdU1UTXlMalV4TUNBWERUSTBNRE15TlRBek16a3lOMW9ZRHpJdwpOVEV3T0RFeE1ETXpPVEkzV2pBWE1SVXdFd1lEVlFRRERBd3hNQzR5TXk0eE16SXVOVEV3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM4Nlc3L3RQLzN4Qk5LMmpZaEVzejBuQ1FjZFExTXQwNEUKcmo2MTlQQmMzbUx4R0tIcjhRdVBwTmw3NDBJdktNSFRyYi9FcWRRRDNQTUN3R2MzZHNzUEYrOHRKNXFtTlFrTwphOVJsU0pZVTdEQVczeFJIdzNkMFk1SkcxQUZxeDZnTlpmU3NCWmdhT2JROFhYQXNxUmpyWXJSWlY1QldKV0c3CkRQd2N1dWR5SExpU2F6dWFuaERkNE5FY2tzL2hlejFqSFdTZWtyaW1oeVNvWjNHMC9OUmlxdnZuOWN1bUtnNEcKSkZlOWQwSGFPbm9Td29mTU9wNFA0eFB4OFk5Qld5S1pFSUVFREt5VmwvWnpNODlpWjkxMy8wS3lhWEFKY251TQpIeitCT2VjK29pYzJJeTZPeUJHcFlJVE5LMHBGMURxV3RPVDltcFQxb2JtSDlDWXJySUpwQWdNQkFBR2pVekJSCk1CMEdBMVVkRGdRV0JCUWZSVEd5UEc3bFg2VDlxUXgvaS9xVVJsOEpoREFmQmdOVkhTTUVHREFXZ0JRZlJUR3kKUEc3bFg2VDlxUXgvaS9xVVJsOEpoREFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQQpBNElCQVFBTVV1T1l2b3VmOW9vZFNFOUF1a3I0bDg4WTNKUUlUMlZpQlhIc0JEcjFnWlBkaks5Nlc1RjJsUFl0CmlBb3dCdlRiVHJyamI1WVFTZmxvc3kxYW1oSzB5QWFNaUYyd1d1dDkrTzdTY1Rza0dIeGNDbklhTjgzSmJkM20KWjczR3doNlcyb2VQYk12eFZNNjJ3Ykl3SE00U3FqRDRqK203OHFHM2JZVi9CK29Db2xwU2JuQzkrVEpnUmFSSQpTV1pqUnZzUERlMFhyam5JMFIwbXBNdTlBNjVWVDVzdEQ0SHlMZFFucExVWW9zYXJUdVhzN2VxWUhmUnpmanB4CjNQSlJGaEh6bytCVVZzVGdMRGhQbnJaNzdOTEtUSTJBTjNmU2JubGlkNFM3alNRNmk1TGI0TXFHWUY5anlPdHoKbmZIb0RxWUdyaVFJY0N5WW9kZlkwVGRzWS9LegotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      url: https://10.23.132.51:5443/owner-reference-dubbo-io-v1alpha1
    rules:
      - apiGroups:
          - dubbo.io
        apiVersions:
          - v1alpha1
        operations:
          - CREATE
        resources:
          - conditionroutes
          - dynamicconfigs
          - tagroutes
    sideEffects: None

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: dubbo-validating-webhook-configuration
  namespace: dubbo-system
  labels:
    app: dubbo-control-plane
    app.kubernetes.io/name: dubbo
    app.kubernetes.io/instance: dubbo
webhooks:
  - name: validator.dubbo-admission.dubbo.io
    admissionReviewVersions: ["v1"]
    failurePolicy: Fail
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values: ["kube-system"]
    clientConfig:
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFVENDQWZtZ0F3SUJBZ0lVSU1hSTdZRStGajF3V0FxQ04zUk5hK0hiUGxrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01NVEF1TWpNdU1UTXlMalV4TUNBWERUSTBNRE15TlRBek16a3lOMW9ZRHpJdwpOVEV3T0RFeE1ETXpPVEkzV2pBWE1SVXdFd1lEVlFRRERBd3hNQzR5TXk0eE16SXVOVEV3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM4Nlc3L3RQLzN4Qk5LMmpZaEVzejBuQ1FjZFExTXQwNEUKcmo2MTlQQmMzbUx4R0tIcjhRdVBwTmw3NDBJdktNSFRyYi9FcWRRRDNQTUN3R2MzZHNzUEYrOHRKNXFtTlFrTwphOVJsU0pZVTdEQVczeFJIdzNkMFk1SkcxQUZxeDZnTlpmU3NCWmdhT2JROFhYQXNxUmpyWXJSWlY1QldKV0c3CkRQd2N1dWR5SExpU2F6dWFuaERkNE5FY2tzL2hlejFqSFdTZWtyaW1oeVNvWjNHMC9OUmlxdnZuOWN1bUtnNEcKSkZlOWQwSGFPbm9Td29mTU9wNFA0eFB4OFk5Qld5S1pFSUVFREt5VmwvWnpNODlpWjkxMy8wS3lhWEFKY251TQpIeitCT2VjK29pYzJJeTZPeUJHcFlJVE5LMHBGMURxV3RPVDltcFQxb2JtSDlDWXJySUpwQWdNQkFBR2pVekJSCk1CMEdBMVVkRGdRV0JCUWZSVEd5UEc3bFg2VDlxUXgvaS9xVVJsOEpoREFmQmdOVkhTTUVHREFXZ0JRZlJUR3kKUEc3bFg2VDlxUXgvaS9xVVJsOEpoREFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQQpBNElCQVFBTVV1T1l2b3VmOW9vZFNFOUF1a3I0bDg4WTNKUUlUMlZpQlhIc0JEcjFnWlBkaks5Nlc1RjJsUFl0CmlBb3dCdlRiVHJyamI1WVFTZmxvc3kxYW1oSzB5QWFNaUYyd1d1dDkrTzdTY1Rza0dIeGNDbklhTjgzSmJkM20KWjczR3doNlcyb2VQYk12eFZNNjJ3Ykl3SE00U3FqRDRqK203OHFHM2JZVi9CK29Db2xwU2JuQzkrVEpnUmFSSQpTV1pqUnZzUERlMFhyam5JMFIwbXBNdTlBNjVWVDVzdEQ0SHlMZFFucExVWW9zYXJUdVhzN2VxWUhmUnpmanB4CjNQSlJGaEh6bytCVVZzVGdMRGhQbnJaNzdOTEtUSTJBTjNmU2JubGlkNFM3alNRNmk1TGI0TXFHWUY5anlPdHoKbmZIb0RxWUdyaVFJY0N5WW9kZlkwVGRzWS9LegotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      url: https://10.23.132.51:5443/validate-dubbo-io-v1alpha1
    rules:
      - apiGroups:
          - dubbo.io
        apiVersions:
          - v1alpha1
        operations:
          - CREATE
          - UPDATE
          - DELETE
        resources:
          - conditionroutes
          - dataplanes
          - dataplaneinsights
          - datasources
          - dynamicconfigs
          - mappings
          - meshes
          - meshinsights
          - metadata
          - secrets
          - servicenamemappings
          - tagroutes
          - zoneegresses
          - zoneingresses
          - zoneingressinsights
          - zoneinsights
          - zones

    sideEffects: None
  - name: service.validator.dubbo-admission.dubbo.io
    admissionReviewVersions: ["v1"]
    failurePolicy: Ignore
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values: ["kube-system"]
    clientConfig:
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFVENDQWZtZ0F3SUJBZ0lVSU1hSTdZRStGajF3V0FxQ04zUk5hK0hiUGxrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01NVEF1TWpNdU1UTXlMalV4TUNBWERUSTBNRE15TlRBek16a3lOMW9ZRHpJdwpOVEV3T0RFeE1ETXpPVEkzV2pBWE1SVXdFd1lEVlFRRERBd3hNQzR5TXk0eE16SXVOVEV3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUM4Nlc3L3RQLzN4Qk5LMmpZaEVzejBuQ1FjZFExTXQwNEUKcmo2MTlQQmMzbUx4R0tIcjhRdVBwTmw3NDBJdktNSFRyYi9FcWRRRDNQTUN3R2MzZHNzUEYrOHRKNXFtTlFrTwphOVJsU0pZVTdEQVczeFJIdzNkMFk1SkcxQUZxeDZnTlpmU3NCWmdhT2JROFhYQXNxUmpyWXJSWlY1QldKV0c3CkRQd2N1dWR5SExpU2F6dWFuaERkNE5FY2tzL2hlejFqSFdTZWtyaW1oeVNvWjNHMC9OUmlxdnZuOWN1bUtnNEcKSkZlOWQwSGFPbm9Td29mTU9wNFA0eFB4OFk5Qld5S1pFSUVFREt5VmwvWnpNODlpWjkxMy8wS3lhWEFKY251TQpIeitCT2VjK29pYzJJeTZPeUJHcFlJVE5LMHBGMURxV3RPVDltcFQxb2JtSDlDWXJySUpwQWdNQkFBR2pVekJSCk1CMEdBMVVkRGdRV0JCUWZSVEd5UEc3bFg2VDlxUXgvaS9xVVJsOEpoREFmQmdOVkhTTUVHREFXZ0JRZlJUR3kKUEc3bFg2VDlxUXgvaS9xVVJsOEpoREFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQQpBNElCQVFBTVV1T1l2b3VmOW9vZFNFOUF1a3I0bDg4WTNKUUlUMlZpQlhIc0JEcjFnWlBkaks5Nlc1RjJsUFl0CmlBb3dCdlRiVHJyamI1WVFTZmxvc3kxYW1oSzB5QWFNaUYyd1d1dDkrTzdTY1Rza0dIeGNDbklhTjgzSmJkM20KWjczR3doNlcyb2VQYk12eFZNNjJ3Ykl3SE00U3FqRDRqK203OHFHM2JZVi9CK29Db2xwU2JuQzkrVEpnUmFSSQpTV1pqUnZzUERlMFhyam5JMFIwbXBNdTlBNjVWVDVzdEQ0SHlMZFFucExVWW9zYXJUdVhzN2VxWUhmUnpmanB4CjNQSlJGaEh6bytCVVZzVGdMRGhQbnJaNzdOTEtUSTJBTjNmU2JubGlkNFM3alNRNmk1TGI0TXFHWUY5anlPdHoKbmZIb0RxWUdyaVFJY0N5WW9kZlkwVGRzWS9LegotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      url: https://10.23.132.51:5443/validate-v1-service
    rules:
      - apiGroups:
          - ""
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - services
    sideEffects: None
